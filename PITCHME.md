### Pythonでクラスを書こう

- 2020年2月20日 初版
- 2020年2月21日 第二版

---

### 対象
- pythonの関数が書ける人 |
- pythonのクラスを勉強したい人 |

---

### 公式ドキュメント

#### 9. クラス — Python 3.8.2rc1 ドキュメント

https://docs.python.org/ja/3/tutorial/classes.html

- クラスはデータと機能を組み合わせる方法を提供します。 
新規にクラスを作成することで、新しいオブジェクトの 型 を作成し、その型を持つ新しい インスタンス が作れます。 
クラスのそれぞれのインスタンスは自身の状態を保持する属性を持てます。 
クラスのインスタンスは、その状態を変更するための (そのクラスが定義する) メソッドも持てます。

---

### まずはクラスをどのように使うのか見てみましょう。

---

### 注意
これからお見せするソースは説明しやすいように、
積極的に日本語化していますが実際に開発する時は日本語で書かないでね。

---

```
class 車の設計図:

    def __init__(self, 色='白'):
        self.色 = 色

    def 色教えて(self):
        メッセージ = '車の色は{}です'
        print(メッセージ.format(self.色))

    def 色変えて(self, 色):
        self.色 = 色
        メッセージ = '車の色を{}に変更しました'
        print(メッセージ.format(self.色))

私の車 = 車の設計図()
私の車.色教えて()
私の車.色変えて('黒')
```

@[1-13](こちらがクラスそのものにあたります)
@[3,6,10](クラスには「def」から始まる関数のようながあります)
@[3,6,10](これはメソッドと呼ばれ第一引数には必ず「self」を記述されています)
@[3,10](メソッドに引数が必要な場合、第二引数以降に明記します)
@[4,8,9,11,13](頭に「self.」がついた変数はインスタンス変数と呼ばれ)
@[4,8,9,11,13](クラス内で共通利用する変数になります)
@[7,12](「self.」がつかない変数の場合、スコープはそのメソッド内のみとなります)
@[15-17](こちらがクラスを呼び出す側です)
@[1-17](ではトレースしながら挙動を確認してみます)
@[15](まず「車の設計図」を元に「私の車」を作成します)
@[1-13,15](「車の設計図」はクラスと呼ばれ)
@[15](「車の設計図」から生成した「私の車」の実体のことを)
@[15](インスタンスと呼ばれます)
@[1-4,15](クラス側ではインスタンス化されるとき)
@[3](特殊メソッドである「\_\_init\_\_」が定義されていると)
@[3](「\_\_init\_\_」メソッドが実行されます)
@[15](今回引数になにも指定していないので)
@[1-4,15](色のデフォルト値である「白」が「self.色」にセットされます)
@[15](もし「私の車 = 車の設計図('青')」としてインスタンスを生成した場合)
@[3-4,15](「self.色 」には、「青」がセットされます)
@[16](「私の車.色教えて()」を使うと)
@[16,6-8](クラス側では「メッセージ」と「self.色」が結合され)
@[16,6-8](「車の色は白です」と出力します)
@[17](「私の車.色変えて('黒')」を使うと)
@[17,10-13](「self.色」に「黒」がセットされ)
@[17,10-13](クラス側では「メッセージ」と「self.色」が結合され)
@[17,10-13](「車の色を黒に変更しました」と出力します)


---

もし、これを関数ですべてやると
こんな感じになります

---

関数版

```
def 色教えて(車データ):
    メッセージ = '車の色は{}です'
    print(メッセージ.format(車データ['色']))

def 色変えて(車データ, 色):
    車データ['色'] = 色
    メッセージ = '車の色を{}に変更しました'
    print(メッセージ.format(車データ['色']))
    return 車データ

私の車 = {'色': '白'}
色教えて(私の車)
私の車 = 色変えて(私の車, '黒')
```

---

クラス版

```
class 車の設計図:

    def __init__(self, 色='白'):
        self.色 = 色

    def 色教えて(self):
        メッセージ = '車の色は{}です'
        print(メッセージ.format(self.色))

    def 色変えて(self, 色):
        self.色 = 色
        メッセージ = '車の色を{}に変更しました'
        print(メッセージ.format(self.色))

私の車 = 車の設計図()
私の車.色教えて()
私の車.色変えて('黒')
```

---

```
def 色教えて(車データ):
    メッセージ = '車の色は{}です'
    print(メッセージ.format(車データ['色']))

def 色変えて(車データ, 色):
    車データ['色'] = 色
    メッセージ = '車の色を{}に変更しました'
    print(メッセージ.format(車データ['色']))
    return 車データ

私の車 = {'色': '白'}
色教えて(私の車)
私の車 = 色変えて(私の車, '黒')
```

@[1-9](クラス部分を関数になるだけでスッキリするが)
@[11-13](関数の場合はデータの管理を自分自身で実施する必要があるので)

---

```
私の車 = {'色': '白'}
色教えて(私の車)
私の車 = 色変えて(私の車, '黒')

あなたの車 = {'色': '赤'}
色教えて(あなたの車)
あなたの車 = 色変えて(あなたの車, '黒')

君の車 = {'色': '緑'}
色教えて(君の車)
君の車 = 色変えて(君の車 , '黒')
```

@[1-9](もし、「あなたの車」や「君の車」が増えたとき)
@[1-9](データを定義したり、渡したり、入れ直したりと大変です)

---

```
私の車 = 車の設計図()
私の車.色教えて()
私の車.色変えて('黒')

あなたの車 = 車の設計図('赤')
あなたの車.色教えて()
あなたの車.色変えて('黒')

君の車 = 車の設計図('緑')
君の車.色教えて()
君の車.色変えて('黒')
```
@[1-9](クラス化した場合はデータの管理が楽になります)
@[1-9](見比べてどうでしょうか)

---

### 結論

クラスも関数型も一長一短ありがあり、
どちらが良くてどちらが悪いというものではない。
その時、その時で最適な方を使えばいいと思います。


---

### 質問受付

---

### もうすこし複雑なクラスを作る

---

### お題

ファーストフードのレジシステム

---

### レジシステムに必要な機能

- メニューを登録 |
- 注文を登録 |
- 注文を確認 |
- 注文の合計金額を確認 |
- お金を受領しよう |
- お釣りを確認しよう |
- 領収書を発行 |

---

### クラス名/メソッド名を命名する

pythonの命名規則に従い名前をつけてみよう

https://pep8-ja.readthedocs.io/ja/latest/

---

|システム名/機能名       |クラス名/メソッド名|
|--                   |-- |--- |
| ファーストフードレジシステム |  | 
| メニューを登録          |  |
| 注文を登録            |  |
| 注文を確認            |  |
| 注文の合計金額を確認    |  |
| お金を受領しよう        |  |
| お釣りを確認しよう       |  |
| 領収書を発行          |  |
---

|システム名/機能名       |クラス名/メソッド名|
|--                   |-- |--- |
| ファーストフードレジシステム | FastFoodSystem | 
| メニューを登録          | set_menu |
| 注文を登録            | set_order |
| 注文を確認            | get_order |
| 注文の合計金額を確認    | get_total_price |
| お金を受領しよう        | set_deposit |
| お釣りを確認しよう       | get_change |
| 領収書を発行          | get_receipt |

---

### クラスを作成

---

```python
class FastFoodSystem:
    """ ファーストフードレジシステム """
    def set_menu(self, menu):
        """ メニューを登録 """
        pass
    def set_order(self, order):
        """ 注文を登録 """
        pass
    def get_order(self):
        """ 注文を確認 """
        pass
    def get_total_price(self):
        """ 注文の合計金額を確認 """
        pass
    def set_deposit(self, deposit):
        """ お金を受領しよう """
        pass
    def get_change(self):
        """ お釣りを確認しよう """
        pass
    def get_receipt(self):
        """ 領収書を発行 """
        pass
```
@[2,4,7,10,13,16,19](機能名はコメントに利用)
@[1,3,6,9,12,15,18](クラス名とメソッドを設置)
@[5,8,11,14,17,20,23](ちなみに pass はコードとしては何も実行したくない場合のプレースホルダです)
@[1-20](これだけでなにもしないクラスが完成)
@[1-20](pass 部分を書き換えることで目的にあったクラスが完成する)

---

このプログラムが実行できたらOK

```python
macdonald = FastFoodSystem()
macdonald.set_menu({'コーラー': 100, 'ハンバーガー': 110, 'ポテト': 100})
macdonald.set_order('ハンバーガー')
macdonald.set_order('ポテト')
macdonald.set_order('コーラー')
macdonald.set_order('モスバーガー')
order = macdonald.get_order()
print(order)                        # ['ハンバーガー', 'ポテト', 'コーラー']
total_price = macdonald.get_total_price()
print(total_price)                 # 310
macdonald.set_deposit(500)
change = macdonald.get_change()
print(change)                       # 190
receipt = macdonald.get_receipt()
print(receipt)                      # {'change': 190,
                                    #  'deposit': 500,
                                    #  'order_list': ['ハンバーガー', 'ポテト', 'コーラー'],
                                    #  'total_price': 310}
```

---

### では実際にメソッド内に手を加えてみよう٩(ˊᗜˋ*)و 

ここにソースがあるよ！
https://raw.githubusercontent.com/mykysyk/slide-python-class/master/vanilla.py 

---

set_menu 

```
    def set_menu(self, menu):
        """ メニューを登録 """
        pass
```

@[3](「pass」を取り除き)

---

set_menu

```
    def set_menu(self, menu):
        """ メニューを登録 """
        self.menu_dict = menu
```

@[3](「self.menu_dict = menu」に変更)

---

set_order

```
    def set_order(self, order):
        """ 注文を登録 """
        pass
```

@[3](「pass」を取り除き)

---

set_order

```
    def __init__(self):
        self.order_list = []

    def set_order(self, order):
        """ 注文を登録 """
        if order in self.menu_dict:
            self.order_list.append(order)
```

@[6](注文商品がメニューにあるときだけ)
@[6-7](「注文リスト」に追加できるようにする)
@[7](しかし「注文リスト」は宣言されていないためエラーとなるので)
@[1,2](「注文リスト」を起動時に配列で初期化させる)

---

get_order

```
    def get_order(self):
        """ 注文を確認 """
        pass
```

@[3](「pass」を取り除き)

---

get_order

```
    def get_order(self):
        """ 注文を確認 """
        return self.order_list
```

@[3](注文リストを返す処理を入れる)

---

残りのメソッドは各自ためしてみましょう。

サンプルではマクドナルドでしたが、モスであったり吉野家とかに変更してもいいです。
メニューにない商品を登録したときにエラーを出すパターンとか
もって帰るか、そこで食べるのかで消費税の軽減税率計算を実施するパターンとか
機能を追加してもOKです。

---

### 実例

https://github.com/mykysyk/slide-python-class/blob/master/fastfoodsystem.py

---

### おわり
